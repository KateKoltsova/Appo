import{u as b,o as p,i as _,_ as w,e as I,c as U,a as o,w as u,v as c,b as L,n as k,p as T,h as x,r as g,j as B,d as f,t as v}from"./app.ccb8f526.js";import{a as S,u as y,L as O}from"./LoadingSpinner.f87b9d35.js";const V=async e=>{try{return await S({url:y.users.byId.url(e),method:"GET"})}catch(n){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",n),n}},j=async(e,n)=>{try{return await S({url:y.users.byId.url(e),method:"PATCH",data:n})}catch(t){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",t),t}};function A(){const e=b();let n=localStorage.getItem("userId"),t=localStorage.getItem("accessToken");const r=()=>{const i=localStorage.getItem("userId"),a=localStorage.getItem("accessToken");(!i||!a||i!==n||a!==t)&&(localStorage.clear(),e.push("/login"))};p(()=>{r();const i=()=>{r()};window.addEventListener("storage",i);const a=setInterval(()=>{const s=localStorage.getItem("userId"),d=localStorage.getItem("accessToken");(s!==n||d!==t)&&(n=s,t=d,r())},1e3);_(()=>{clearInterval(a),window.removeEventListener("storage",i)})})}const h={id:null,firstname:"",lastname:"",birthdate:"",email:"",phone_number:"",role_id:null,role:"",image_url:""};const m=e=>(T("data-v-d6295bde"),e=e(),x(),e),E=m(()=>o("label",{for:"firstname"},"FirstName:",-1)),F=m(()=>o("label",{for:"lastname"},"Lastname:",-1)),N=m(()=>o("label",{for:"birthdate"},"Birthdate:",-1)),C=m(()=>o("label",{for:"email"},"Email:",-1)),M=m(()=>o("label",{for:"phone_number"},"Phone number:",-1)),D=["disabled"],P={__name:"UserForm",props:{editedUser:Object,isLoading:Boolean},emits:["onSave"],setup(e,{emit:n}){const t=n,r=()=>{t("onSave")};return(i,a)=>(I(),U("form",{onSubmit:L(r,["prevent"]),class:k({disabled:e.isLoading})},[o("div",null,[E,u(o("input",{type:"text",id:"firstname","onUpdate:modelValue":a[0]||(a[0]=s=>e.editedUser.firstname=s)},null,512),[[c,e.editedUser.firstname]])]),o("div",null,[F,u(o("input",{type:"text",id:"lastname","onUpdate:modelValue":a[1]||(a[1]=s=>e.editedUser.lastname=s)},null,512),[[c,e.editedUser.lastname]])]),o("div",null,[N,u(o("input",{type:"date",id:"birthdate","onUpdate:modelValue":a[2]||(a[2]=s=>e.editedUser.birthdate=s)},null,512),[[c,e.editedUser.birthdate]])]),o("div",null,[C,u(o("input",{type:"email",id:"email","onUpdate:modelValue":a[3]||(a[3]=s=>e.editedUser.email=s)},null,512),[[c,e.editedUser.email]])]),o("div",null,[M,u(o("input",{type:"tel",id:"phone_number","onUpdate:modelValue":a[4]||(a[4]=s=>e.editedUser.phone_number=s)},null,512),[[c,e.editedUser.phone_number]])]),o("button",{type:"submit",disabled:e.isLoading},"Save",8,D)],34))}},H=w(P,[["__scopeId","data-v-d6295bde"]]),G={__name:"UserProfile",setup(e){const n=g({...h}),t=B({...h}),r=g(!1);b(),A(),p(async()=>{r.value=!0;const s=localStorage.getItem("userId"),d=localStorage.getItem("user");if(d)i(JSON.parse(d));else try{const l=await V(s);l.status===200?i(l.data.data):console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F")}catch(l){console.error(l)}r.value=!1});const i=s=>{Object.assign(n.value,s),Object.assign(t,s),localStorage.setItem("user",JSON.stringify(s))},a=async()=>{r.value=!0;const s=localStorage.getItem("userId"),d={};for(const l in t)t[l]!==n.value[l]&&(d[l]=t[l]);if(Object.keys(d).length===0){console.log("\u041D\u0435\u0442 \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0439 \u0434\u043B\u044F \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F"),r.value=!1;return}try{(await j(s,d)).status===200?i(t):console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F")}catch(l){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0442\u0438:",l)}r.value=!1};return(s,d)=>(I(),U("div",null,[f(O,{isLoading:r.value},null,8,["isLoading"]),o("h2",null,"Hello, user "+v(t==null?void 0:t.firstname)+" "+v(t==null?void 0:t.lastname),1),f(H,{editedUser:t,isLoading:r.value,onOnSave:a},null,8,["editedUser","isLoading"])]))}};export{G as default};
